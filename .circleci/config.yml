# ========================================
# CircleCI Self-hosted Runner ãƒ‡ãƒ¢è¨­å®š
# ========================================
# ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€CircleCIã®Self-hosted Runneræ©Ÿèƒ½ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã§ã™ã€‚
# Self-hosted Runnerã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãŠå®¢æ§˜ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ä¸Šã§CIã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚
#
# ğŸ“š å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:
# - Runneræ¦‚è¦: https://circleci.com/docs/guides/execution-runner/runner-overview/
# - Runneræ¦‚å¿µï¼ˆNamespace/Resource Classï¼‰: https://circleci.com/docs/guides/execution-runner/runner-concepts/
# - Machine Runnerã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆLinuxï¼‰: https://circleci.com/docs/guides/execution-runner/runner-installation-linux/
# - Machine Runnerã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSï¼‰: https://circleci.com/docs/guides/execution-runner/runner-installation-mac/
# - Container Runnerã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆKubernetesï¼‰: https://circleci.com/docs/guides/execution-runner/container-runner-installation/
# - Machine Runneræ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: https://circleci.com/docs/guides/execution-runner/machine-runner-3-manual-installation/
#
# ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †:
# 1. CircleCIã®Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€ŒSelf-Hosted Runnersã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹
# 2. æ–°ã—ã„Runner Resource Classã‚’ä½œæˆï¼ˆä¾‹: <namespace>/<resource-class-name>ï¼‰
# 3. æä¾›ã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦Runnerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# 4. ä¸‹è¨˜ã®`resource_class`ã‚’ä½œæˆã—ãŸResource Classã«æ›´æ–°
# ========================================

version: 2.1

# Orbs: å†åˆ©ç”¨å¯èƒ½ãªè¨­å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
orbs:
  node: circleci/node@7.2.1  # Node.jsãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆç”¨ã®orb

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œé †åºã‚’å®šç¾©
workflows:
  testing:
    jobs:
      # Self-hosted Runnerã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚¸ãƒ§ãƒ–
      - runner-test
      
      # CircleCIæ¨™æº–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã‚‹Node.jsãƒ†ã‚¹ãƒˆã‚¸ãƒ§ãƒ–ï¼ˆæ¯”è¼ƒç”¨ï¼‰
      - node/test:
          pkg-manager: npm
          run-command: test:ci

# ã‚¸ãƒ§ãƒ–å®šç¾©
jobs:
  # Self-hosted Runner ãƒ‡ãƒ¢ã‚¸ãƒ§ãƒ–
  runner-test:
    # machine: trueã¯ã€Docker Executorã§ã¯ãªãå°‚ç”¨ã®ãƒã‚·ãƒ³ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æŒ‡å®š
    machine: true
    
    # âš ï¸ é‡è¦: resource_classã‚’å®Ÿéš›ã«ä½œæˆã—ãŸRunner Resource Classã«ç½®ãæ›ãˆã¦ãã ã•ã„
    # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: <namespace>/<resource-class-name>
    # ä¾‹: your-org/my-runner, your-company/production-runner
    resource_class: hidetaka/first-local-runner
    
    steps:
      # Self-hosted Runnerä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰
      - run: echo "Hi I'm on Runners!"
      
      # è¿½åŠ ã®ã‚¹ãƒ†ãƒƒãƒ—ä¾‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã—ã¦ä½¿ç”¨ï¼‰:
      # - checkout  # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      # - run: 
      #     name: ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã®è¡¨ç¤º
      #     command: |
      #       echo "Hostname: $(hostname)"
      #       echo "OS: $(uname -a)"
      # - run:
      #     name: ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰å‡¦ç†
      #     command: npm ci && npm run build
